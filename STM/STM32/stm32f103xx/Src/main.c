/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2025 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */
#include <stm32f103xx.h>
#include <gpiox_driver.h>
#include <analog_driver.h>
#include <rcc_driver.h>
#include <timerx_driver.h>
void SysClock_Init(void);
void IR_Init(void);

GPIO_Handle_t Analog1;
RCC_Handle_t hRcc;
ADC_Handle_t hAdc;
uint16_t sensor = 0;
TIMER2_5_Handle_t Timer2;


int main(void) {
	SysClock_Init();
	IR_Init();
	Timer2 = TIMER2_5_Init_Delay(TIMER2, 719999);

	for (;;) {1
		sensor = ADC_ReadChannel(ADC1, ADC_CHANNEL_0);
		TIMER2_5_Delay(&Timer2, 99);

	}
}

void SysClock_Init(void) {

	hRcc.Config.clk_src = RCC_CLK_PLL;       // Sử dụng PLL làm nguồn xung chính
	hRcc.Config.pll_src = RCC_PLL_SRC_HSE; // Chọn HSE làm nguồn đầu vào cho PLL
	hRcc.Config.pll_mul = RCC_PLL_MUL_9;            // Hệ số nhân PLL = 9
	hRcc.Config.ahb_prescaler = RCC_AHB_DIV_1;      // AHB không chia
	hRcc.Config.apb1_prescaler = RCC_APB_DIV_2;     // APB1 chia 2
	hRcc.Config.apb2_prescaler = RCC_APB_DIV_1;     // APB2 không chia

	// Gọi hàm cấu hình đồng hồ
	RCC_ConfigClock(&hRcc);

}

void IR_Init(void)
{
	Analog1 = GPIO_Init(GPIOA, GPIO_PIN_0, GPIO_MODE_INPUT, GPIO_CNF_INPUT_ANALOG);
	hAdc.Instance = ADC1;
	hAdc.Config.channel[0] = ADC_CHANNEL_0;
	hAdc.Config.sampleTime = ADC_SAMPLE_71CYCLES5;
	hAdc.Config.numChannels = 1;
	ADC_Init(&hAdc);



}


